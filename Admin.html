<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>LocalStorage Admin Panel (SPA)</title>
    <style>
      :root {
        --bg: #f6f7fb;
        --card: #fff;
        --muted: #6b7280;
        --accent: #6366f1;
      }
      .dark {
        --bg: #0b1220;
        --card: #0f1724;
        --muted: #9ca3af;
        --accent: #7c3aed;
        color: #e6eef8;
      }
      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        font-family: Inter, Segoe UI, system-ui, Roboto, Arial;
        background: var(--bg);
        color: #0f1724;
        transition: background 0.25s, color 0.25s;
      }
      .container {
        max-width: 1000px;
        margin: 28px auto;
        padding: 18px;
      }
      .card {
        background: var(--card);
        border-radius: 12px;
        box-shadow: 0 6px 20px rgba(8, 15, 30, 0.06);
        padding: 18px;
      }
      header {
        display: flex;
        gap: 12px;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 18px;
      }
      h1 {
        font-size: 20px;
        margin: 0;
      }
      .nav {
        display: flex;
        gap: 8px;
      }
      .btn {
        background: var(--accent);
        color: white;
        padding: 8px 12px;
        border-radius: 8px;
        border: 0;
        cursor: pointer;
        box-shadow: 0 4px 12px rgba(99, 102, 241, 0.18);
      }
      .btn.ghost {
        background: transparent;
        color: var(--accent);
        box-shadow: none;
        border: 1px solid rgba(99, 102, 241, 0.12);
      }
      input,
      select,
      textarea {
        padding: 10px;
        border-radius: 8px;
        border: 1px solid #e6e9f2;
        width: 100%;
        outline: none;
      }
      .flex {
        display: flex;
        gap: 12px;
      }
      .col {
        flex: 1;
      }
      .small {
        font-size: 13px;
        color: var(--muted);
      }
      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 12px;
      }
      th,
      td {
        padding: 10px;
        border-bottom: 1px solid rgba(0, 0, 0, 0.06);
        text-align: left;
      }
      th {
        font-weight: 600;
        font-size: 13px;
      }
      .actions button {
        margin-right: 6px;
      }
      .fade {
        transition: all 0.22s ease;
      }
      /* animated entrance */
      .card.animate {
        transform: translateY(6px);
        opacity: 0;
        animation: entrance 0.34s forwards;
      }
      @keyframes entrance {
        to {
          transform: none;
          opacity: 1;
        }
      }
      .hidden {
        display: none;
      }
      .search {
        display: flex;
        gap: 8px;
      }
      .pill {
        display: inline-block;
        padding: 6px 10px;
        border-radius: 999px;
        background: rgba(99, 102, 241, 0.12);
        color: var(--accent);
        font-weight: 600;
      }
      .danger {
        background: #fee2e2;
        color: #991b1b;
      }
      .muted {
        color: var(--muted);
      }
      .switch {
        display: inline-flex;
        align-items: center;
        gap: 8px;
      }
      /* responsive */
      @media (max-width: 720px) {
        .flex {
          flex-direction: column;
        }
        .nav {
          flex-wrap: wrap;
        }
      }
      /* Enhanced Styling */
      body {
        background: linear-gradient(135deg, #1e1e2f, #2d2d44);
        font-family: "Poppins", sans-serif;
        overflow-x: hidden;
      }

      .card {
        background: rgba(255, 255, 255, 0.08);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 20px;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
        transition: 0.3s ease;
      }
      .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 0 25px rgba(0, 0, 0, 0.4);
      }

      .btn {
        padding: 10px 18px;
        border-radius: 10px;
        border: none;
        cursor: pointer;
        background: #4b7bec;
        color: white;
        transition: 0.3s;
      }
      .btn:hover {
        background: #3867d6;
      }

      .search-box input {
        padding: 10px;
        width: 300px;
        border-radius: 8px;
        border: none;
        outline: none;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
      }

      .table-container {
        margin-top: 20px;
        background: rgba(255, 255, 255, 0.08);
        padding: 15px;
        border-radius: 15px;
        backdrop-filter: blur(10px);
      }

      table {
        width: 100%;
        border-collapse: collapse;
      }
      th,
      td {
        padding: 12px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      }
      th {
        background: rgba(255, 255, 255, 0.15);
      }

      .hidden-data {
        filter: blur(6px);
        transition: 0.3s;
      }
      .hidden-data:hover {
        filter: blur(0);
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div id="app"></div>
    </div>

    <script>
      /* Single-file SPA that uses LocalStorage only.
   Routes: #/register  #/admin-login  #/admin  #/404
   Default admin password: admin123 (you can change it from admin settings)
*/

      // ---------- Utilities ----------
      const qs = (s) => document.querySelector(s);
      const qsa = (s) => Array.from(document.querySelectorAll(s));
      const saveUsers = (users) =>
        localStorage.setItem("ls_users", JSON.stringify(users));
      const loadUsers = () =>
        JSON.parse(localStorage.getItem("ls_users") || "[]");
      const setMode = (m) => localStorage.setItem("ls_mode", m);
      const getMode = () => localStorage.getItem("ls_mode") || "light";
      const getAdminPass = () =>
        localStorage.getItem("ls_admin_pass") || "admin123";
      const setAdminPass = (p) => localStorage.setItem("ls_admin_pass", p);

      // ---------- Routing & Views ----------
      function navigate(route) {
        location.hash = route;
      }
      function currentRoute() {
        return location.hash.replace("#", "") || "/register";
      }

      window.addEventListener("hashchange", render);
      window.addEventListener("load", () => {
        applyMode();
        render();
      });

      function applyMode() {
        if (getMode() === "dark") document.body.classList.add("dark");
        else document.body.classList.remove("dark");
      }

      // ---------- Templates ----------
      function viewRegister() {
        return `
  <div class="card animate">
    <header>
      <h1>Register (LocalStorage)</h1>
      <div class="nav">
        <button class="btn" onclick="navigate('/admin-login')">Admin Login</button>
        <button class="btn ghost" onclick="navigate('/register')">Refresh</button>
      </div>
    </header>

    <div class="flex">
      <div class="col">
        <label class="small">Full name</label>
        <input id="r_name" placeholder="John Doe" />
      </div>
      <div class="col">
        <label class="small">Email</label>
        <input id="r_email" placeholder="name@example.com" />
      </div>
      <div style="width:180px">
        <label class="small">Phone</label>
        <input id="r_phone" placeholder="9876543210" />
      </div>
    </div>

    <div style="margin-top:12px;display:flex;gap:8px;align-items:center">
      <button class="btn" id="regBtn">Register</button>
      <div class="muted">Your data will be saved locally in the browser.</div>
    </div>

    <hr style="margin:18px 0">
    <div class="small">Already registered users (preview):</div>
    <div id="previewList"></div>
  </div>`;
      }

      function viewAdminLogin() {
        return `
  <div class="card animate">
    <header>
      <h1>Admin Login</h1>
      <div class="nav">
        <button class="btn ghost" onclick="navigate('/register')">Back to register</button>
      </div>
    </header>

    <div style="max-width:420px">
      <label class="small">Super-admin password</label>
      <input id="admin_pass_input" type="password" placeholder="Enter super-admin password" />
      <div style="margin-top:12px;display:flex;gap:8px">
        <button class="btn" id="adminLoginBtn">Login</button>
        <button class="btn ghost" onclick="demoShowPass()">Show default</button>
      </div>
    </div>
  </div>`;
      }

      function view404() {
        return `
  <div class="card animate">
    <header>
      <h1>404 — Not Found</h1>
      <div class="nav">
        <button class="btn" onclick="navigate('index.html')">Home</button>
      </div>
    </header>
    <p class="small">Sorry, you don't have access to that resource.</p>
    <div style="margin-top:12px">If you believe this is a mistake request access from the site developer.</div>
  </div>`;
      }

      function viewAdmin() {
        const users = loadUsers();
        const total = users.length;
        const verified = users.filter((u) => u.verified).length;
        const pending = total - verified;

        return `
  <div class="card animate">
    <header>
      <h1>Admin Panel</h1>
      <div class="nav">
        <span class="pill">Total ${total}</span>
        <span class="pill">Verified ${verified}</span>
        <span class="pill">Pending ${pending}</span>
        <button class="btn ghost" onclick="logoutAdmin()">Logout</button>
      </div>
    </header>

    <div class="flex" style="align-items:center;margin-bottom:12px">
      <div style="flex:1">
        <input id="searchBox" placeholder="Search by name or email" oninput="renderAdminTable()" />
      </div>
      <div style="display:flex;gap:8px;align-items:center">
        <div class="switch">
          <label class="small">Hide sensitive</label>
          <input id="hideSensitive" type="checkbox" />
        </div>
        <button class="btn" onclick="exportExcel()">Export Excel</button>
        <button class="btn ghost" onclick="toggleModeButton()">Toggle Dark</button>
      </div>
    </div>

    <div class="card" style="padding:0;overflow:auto">
      <table id="adminTable">
        <thead><tr><th>Name</th><th>Email</th><th>Phone</th><th>Verified</th><th>Actions</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>

    <hr style="margin:12px 0">
    <div style="display:flex;gap:12px;flex-wrap:wrap">
      <div style="flex:1;min-width:220px">
        <div class="small">Change super-admin password</div>
        <div class="flex" style="margin-top:6px">
          <input id="newAdminPass" placeholder="new password" />
          <button class="btn" onclick="changeAdminPass()">Change</button>
        </div>
      </div>

      <div style="flex:1;min-width:220px">
        <div class="small">Pending verification requests</div>
        <div id="pendingList" class="small muted"></div>
      </div>
    </div>

  </div>`;
      }

      // ---------- Render ----------
      function render() {
        const route = currentRoute();
        const el = document.getElementById("app");
        if (route === "/register" || route === "") {
          el.innerHTML = viewRegister();
          bindRegister();
        } else if (route === "/admin-login") {
          el.innerHTML = viewAdminLogin();
          bindAdminLogin();
        } else if (route === "/admin") {
          // check session
          if (sessionStorage.getItem("ls_admin_logged") === "1") {
            el.innerHTML = viewAdmin();
            bindAdmin();
          } else {
            // fake 404 to hide panel from unauthorized users
            el.innerHTML = view404();
          }
        } else {
          el.innerHTML = view404();
        }
      }

      // ---------- Register bindings ----------
      function bindRegister() {
        qs("#regBtn").addEventListener("click", () => {
          const name = qs("#r_name").value.trim();
          const email = qs("#r_email").value.trim().toLowerCase();
          const phone = qs("#r_phone").value.trim();

          if (!name || !email) return alert("Name and email required");

          const users = loadUsers();
          if (users.some((u) => u.email === email)) {
            return alert("Email already registered");
          }

          users.push({ id: Date.now(), name, email, phone, verified: false });
          saveUsers(users);

          qs("#r_name").value = "";
          qs("#r_email").value = "";
          qs("#r_phone").value = "";
          alert("Registered! Your account requires verification.");
          render();
        });

        // preview list
        const preview = loadUsers().slice(-6).reverse();
        const out = preview.length
          ? preview
              .map(
                (u) =>
                  `<div class="small">${u.name} — ${u.email} ${
                    u.verified ? '<span class="pill">Verified</span>' : ""
                  }</div>`
              )
              .join("")
          : '<div class="small muted">No users yet</div>';
        qs("#previewList").innerHTML = out;
      }

      // ---------- Admin login bindings ----------
      function bindAdminLogin() {
        qs("#adminLoginBtn").addEventListener("click", () => {
          const p = qs("#admin_pass_input").value;
          if (p === getAdminPass()) {
            sessionStorage.setItem("ls_admin_logged", "1");
            navigate("/admin");
          } else {
            // Redirect to fake 404 to hide existence of admin panel
            navigate("/404");
          }
        });
        qs("#admin_pass_input").addEventListener("keydown", (e) => {
          if (e.key === "Enter") qs("#adminLoginBtn").click();
        });
      }
      function demoShowPass() {
        alert(
          'Default super-admin password: "admin123"\nYou can change it after login.'
        );
      }

      // ---------- Admin view bindings & functions ----------
      function bindAdmin() {
        // set hide checkbox default
        qs("#hideSensitive").checked =
          (localStorage.getItem("ls_hide_sensitive") || "1") === "1";
        qs("#hideSensitive").addEventListener("change", () => {
          localStorage.setItem(
            "ls_hide_sensitive",
            qs("#hideSensitive").checked ? "1" : "0"
          );
          renderAdminTable();
        });

        renderAdminTable();
        renderPendingList();
      }

      function renderAdminTable() {
        const tbody = qs("#adminTable tbody");
        const users = loadUsers();
        const q = qs("#searchBox")?.value?.toLowerCase() || "";
        const hide = (localStorage.getItem("ls_hide_sensitive") || "1") === "1";

        const filtered = users.filter(
          (u) =>
            u.name.toLowerCase().includes(q) ||
            u.email.toLowerCase().includes(q)
        );
        tbody.innerHTML =
          filtered
            .map((u) => {
              const phone = hide ? "******" : u.phone || "";
              return `
      <tr>
        <td>${escapeHtml(u.name)}</td>
        <td>${escapeHtml(u.email)}</td>
        <td>${escapeHtml(phone)}</td>
        <td>${u.verified ? "✅" : "❌"}</td>
        <td class="actions">
          <button onclick="adminEdit(${u.id})">Edit</button>
          <button onclick="adminDelete(${u.id})" class="danger">Delete</button>
          ${
            u.verified
              ? ""
              : `<button onclick="adminVerify(${u.id})">Verify</button>`
          }
        </td>
      </tr>`;
            })
            .join("") ||
          '<tr><td colspan="5" class="muted small">No results</td></tr>';
      }

      function renderPendingList() {
        const pending = loadUsers().filter((u) => !u.verified);
        qs("#pendingList").innerHTML = pending.length
          ? pending
              .map((u) => `• ${escapeHtml(u.name)} — ${escapeHtml(u.email)}`)
              .join("<br>")
          : '<span class="muted">No pending requests</span>';
      }

      function adminDelete(id) {
        if (!confirm("Delete user?")) return;
        const users = loadUsers().filter((u) => u.id !== id);
        saveUsers(users);
        renderAdminTable();
        renderPendingList();
      }
      function adminVerify(id) {
        const users = loadUsers();
        users.forEach((u) => {
          if (u.id === id) u.verified = true;
        });
        saveUsers(users);
        renderAdminTable();
        renderPendingList();
      }
      function adminEdit(id) {
        const users = loadUsers();
        const u = users.find((x) => x.id === id);
        if (!u) return;
        const name = prompt("Name", u.name);
        if (!name) return;
        const email = prompt("Email", u.email);
        if (!email) return;
        const phone = prompt("Phone", u.phone || "");
        u.name = name;
        u.email = email;
        u.phone = phone;
        saveUsers(users);
        renderAdminTable();
        renderPendingList();
      }

      function exportExcel() {
        const users = loadUsers();
        let content = "Name\tEmail\tPhone\tVerified\n";
        users.forEach(
          (u) =>
            (content += `${u.name}\t${u.email}\t${u.phone || ""}\t${
              u.verified
            }\n`)
        );
        const blob = new Blob([content], { type: "application/vnd.ms-excel" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "users.xls";
        a.click();
      }

      function logoutAdmin() {
        sessionStorage.removeItem("ls_admin_logged");
        navigate("/register");
      }

      function toggleModeButton() {
        const cur = getMode();
        setMode(cur === "dark" ? "light" : "dark");
        applyMode();
      }

      function changeAdminPass() {
        const v = qs("#newAdminPass").value.trim();
        if (!v) return alert("Enter new password");
        setAdminPass(v);
        qs("#newAdminPass").value = "";
        alert("Password changed");
      }

      // ---------- Helpers ----------
      function escapeHtml(s) {
        return (s || "")
          .toString()
          .replace(/&/g, "&amp;")
          .replace(/</g, "&lt;")
          .replace(/>/g, "&gt;");
      }

      // Simple guard to show fake 404 route name
      function navigateToProtected() {
        if (sessionStorage.getItem("ls_admin_logged") === "1")
          navigate("/admin");
        else navigate("/404");
      }
    </script>
  </body>
</html>
